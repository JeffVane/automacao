<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Buscador de Leads</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-rocket"></i>
                Dashboard
            </a>
            <div class="navbar-user">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span>Bem-vindo, {{ username }}</span>
                </div>
                <a href="{{ url_for('logout') }}" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </div>
        </div>
    </nav>

    <!-- üî• Abas -->
    <div class="tabs">
        <button class="tab-btn active" onclick="abrirAba('buscador')">
            <i class="fas fa-search"></i> Buscador de Leads
        </button>
        <button class="tab-btn" onclick="abrirAba('historico')">
            <i class="fas fa-history"></i> Hist√≥rico
        </button>
        <button class="tab-btn" onclick="abrirAba('config')">
            <i class="fas fa-cog"></i> Configura√ß√µes
        </button>
        <button class="tab-btn" onclick="abrirAba('conversas')">
        <i class="fas fa-comments"></i> Conversas
        </button>
    </div>

    <div class="main-container">
    <!-- üîç Aba Buscador -->
    <div id="aba-buscador" class="aba-content show">
        <div class="search-card fade-in">
            <h2 class="card-title">
                <i class="fas fa-search"></i>
                Buscador de Leads
            </h2>
            <form class="search-form" onsubmit="iniciarBusca(); return false;">
                <div class="input-group">
                    <i class="fas fa-search input-icon"></i>
                    <input
                        id="termo"
                        class="form-input"
                        placeholder="Digite o termo, ex: Cl√≠nica Odontol√≥gica"
                        required
                    >
                </div>
                <div class="input-group">
                    <i class="fas fa-hashtag input-icon"></i>
                    <input
                        id="limite"
                        type="number"
                        class="form-input"
                        value="50"
                        min="1"
                        max="100"
                        placeholder="Qtd de leads (m√°x 100)"
                        required
                    >
                </div>
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i>
                    Buscar
                </button>
            </form>
        </div>

        <!-- üî• Status da Busca -->
        <div class="status-busca" id="status-busca">
            <p id="mensagem-status">Aguardando...</p>
            <div class="barra-progresso">
                <div id="progresso-barra" class="progresso-barra"></div>
            </div>
            <div id="progresso-porcentagem">0%</div>

            <!-- üî• O que o rob√¥ est√° vendo -->
            <div class="visao-atual">
                <h4>üïµÔ∏è‚Äç‚ôÇÔ∏è Vendo no Google Maps:</h4>
                <ul id="lista-visao-atual"></ul>
            </div>
        </div>

        <!-- üî• Resultados -->
        <div id="resultado" class="results-container"></div>
    </div>
</div>



        <!-- üìú Aba Hist√≥rico -->
        <div id="aba-historico" class="aba-content">
            <h2><i class="fas fa-history"></i> Hist√≥rico</h2>
            <p>exibir o hist√≥rico de buscas realizadas.</p>
        </div>

        <!-- ‚öôÔ∏è Aba Configura√ß√µes -->
        <div id="aba-config" class="aba-content">
            <h2><i class="fas fa-cog"></i> Configura√ß√µes</h2>
            <p>gerenciar usu√°rios e prefer√™ncias.</p>
        </div>
    </div>

    <!-- üìú Aba Conversas -->
    <div id="aba-conversas" class="aba-content">
    <h2><i class="fas fa-comments"></i> Conversas</h2>

    <div class="chat-wrapper">
        <!-- Lista de clientes -->
        <div class="chat-sidebar">
            <h4>Clientes</h4>
            <ul id="lista-clientes">
                <li onclick="selecionarCliente('cliente1')">Cliente 1</li>
                <li onclick="selecionarCliente('cliente2')">Cliente 2</li>
                <li onclick="selecionarCliente('cliente3')">Cliente 3</li>
            </ul>
        </div>

        <!-- √Årea do chat -->
        <div class="chat-area">
            <div class="chat-messages" id="chat-messages">
                <!-- Mensagens aparecer√£o aqui -->
            </div>

            <div class="chat-input">
                <input type="text" id="mensagem" placeholder="Digite sua mensagem...">
                <button onclick="enviarMensagem()">
                    <i class="fas fa-paper-plane"></i> Enviar
                </button>
            </div>
        </div>
    </div>
</div>



    <script>
        // üîÑ Controle das Abas
        function abrirAba(nomeAba) {
            const abas = document.querySelectorAll('.aba-content');
            const botoes = document.querySelectorAll('.tab-btn');

            abas.forEach(aba => aba.classList.remove('show'));
            botoes.forEach(btn => btn.classList.remove('active'));

            document.getElementById(`aba-${nomeAba}`).classList.add('show');
            event.target.classList.add('active');
        }

        // üîç Fun√ß√£o de Busca (j√° existente)
        async function buscar() {
            const termo = document.getElementById('termo').value;
            const loadingEl = document.getElementById('loading');
            const resultadoEl = document.getElementById('resultado');

            loadingEl.classList.add('show');
            resultadoEl.innerHTML = '';

            try {
                const res = await fetch('/api/buscar-dados-maps', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({termo: termo, limite: 5})
                });

                const dados = await res.json();
                loadingEl.classList.remove('show');

                if (dados.length === 0) {
                    resultadoEl.innerHTML = `
                        <div class="empty-state fade-in">
                            <i class="fas fa-search empty-icon"></i>
                            <h3>Nenhum resultado encontrado</h3>
                            <p>Tente refinar sua busca ou usar termos diferentes</p>
                        </div>
                    `;
                    return;
                }

                let html = '';
                dados.forEach((item, index) => {
                    html += `
                        <div class="result-card fade-in" style="animation-delay: ${index * 0.1}s">
                            <h3 class="result-title">
                                <i class="fas fa-building"></i>
                                ${item.nome}
                            </h3>
                            <div class="result-info">
                                <div class="info-item">
                                    <i class="fas fa-map-marker-alt info-icon"></i>
                                    <span>${item.endereco}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-phone info-icon"></i>
                                    <span>${item.telefone}</span>
                                </div>
                                <div class="info-item">
                                    <i class="fas fa-globe info-icon"></i>
                                    <a href="${item.site}" target="_blank" class="info-link">${item.site}</a>
                                </div>
                            </div>
                        </div>
                    `;
                });

                resultadoEl.innerHTML = html;

            } catch (error) {
                loadingEl.classList.remove('show');
                resultadoEl.innerHTML = `
                    <div class="empty-state fade-in">
                        <i class="fas fa-exclamation-triangle empty-icon" style="color: var(--danger)"></i>
                        <h3>Erro na busca</h3>
                        <p>Ocorreu um erro ao buscar os dados. Tente novamente.</p>
                    </div>
                `;
                console.error('Erro na busca:', error);
            }
        }

        document.getElementById('termo').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                buscar();
            }
        });

        window.addEventListener('load', function() {
            document.querySelector('.search-card').style.animationDelay = '0.2s';
        });
    </script>

<script src="static/conversas.js"></script>
<script src="static/buscador.js"></script>


</body>
</html>
